# イベント作成・編集画面設計書

## 1. 画面概要

### 1.1 画面名
イベント作成・編集画面

### 1.2 目的
新しいイベントの作成、または既存イベントの編集を行う画面。イベント名、カテゴリーアイコン、最終実行日時を入力・設定できる。

### 1.3 アクセス方法

#### 作成モード
- メイン画面の右下FAB（フローティングアクションボタン）をタップ
- URL: `/events/new`

#### 編集モード
- イベント履歴画面から編集ボタンをタップ
- URL: `/events/:id/edit`

### 1.4 URL設計

#### フロントエンドURL
```
ベースURL: https://example.com

# 新規作成
/events/new

# 編集（:idはイベントID）
/events/:id/edit

# 例
/events/evt_1234567890/edit
```

#### バックエンドAPI URL
```
ベースURL: https://api.example.com

# イベント作成
POST /events

# イベント更新
PUT /events/:id
PATCH /events/:id

# イベント詳細取得（編集時に使用）
GET /events/:id
```

## 2. 画面構成

### 2.1 レイアウト構成

```
┌─────────────────────────────────────┐
│ ✕  新しいイベント            完了   │ ← ヘッダー
├─────────────────────────────────────┤
│                                     │
│  イベント名                          │ ← ラベル
│  ┌───────────────────────────────┐  │
│  │ 重要なイベントをここに入力する  │  │ ← テキスト入力
│  └───────────────────────────────┘  │
│                                     │
│  カテゴリー                          │ ← ラベル
│  ┌───┬───┬───┬───┬───┐            │
│  │📌 │📚 │📁 │⭐ │📊 │            │ ← アイコングリッド
│  └───┴───┴───┴───┴───┘            │   (選択中は強調表示)
│  ┌───┬───┬───┬───┬───┐            │
│  │☀️ │👤 │🏥 │➕ │🍃 │            │
│  └───┴───┴───┴───┴───┘            │
│  ┌───┬───┬───┬───┬───┐            │
│  │🔍 │👥 │❄️ │🔥 │⚡ │            │
│  └───┴───┴───┴───┴───┘            │
│                                     │
│  最終実行日時                        │ ← ラベル
│  ┌───────────────────────────────┐  │
│  │ 2026/01/15                    │  │ ← 日付ピッカー
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │ 23:31                         │  │ ← 時刻ピッカー
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

### 2.2 UI コンポーネント構成

#### ヘッダー（Header）

**左側: キャンセルボタン**
- アイコン: ✕（バツ印）
- テキスト: なし
- 位置: 左端
- アクション: 入力内容を破棄して前の画面に戻る
- 確認ダイアログ: 変更がある場合のみ表示

**中央: タイトル**
- 作成モード: "新しいイベント"
- 編集モード: "イベントを編集"
- フォントサイズ: 18px（モバイル）、20px（デスクトップ）
- フォントウェイト: 600（Semi-Bold）

**右側: 完了ボタン**
- テキスト: "完了"
- 色: プライマリーカラー (#3B82F6)
- 位置: 右端
- アクション: バリデーション → 保存 → 前の画面に戻る
- 無効状態: イベント名が空の場合はグレーアウト

#### イベント名入力（Text Input）

**スタイル:**
- フォントサイズ: 16px
- パディング: 12px（上下）、16px（左右）
- ボーダー: 1px solid #E5E7EB
- ボーダーラジアス: 8px
- 背景色: 白 (#FFFFFF)
- フォーカス時のボーダー: 2px solid #3B82F6
- 最大文字数: 100文字

**プレースホルダー:**
- テキスト: "重要なイベントをここに入力する"
- 色: グレー (#9CA3AF)

**バリデーション:**
- 必須項目
- 最大100文字
- エラー時にボーダーを赤色表示
- エラーメッセージを入力欄下部に表示

**エラーメッセージ例:**
- "イベント名を入力してください"
- "イベント名は100文字以内で入力してください"

#### カテゴリーアイコン選択（Icon Selector）

**レイアウト:**
- 5列のグリッド
- 15個のアイコンから1つ選択（ラジオボタンの挙動）
- アイコンサイズ: 48x48px（タップ領域）
- アイコン実サイズ: 28x28px
- ギャップ: 12px
- パディング: 20px（左右）、16px（上下）

**アイコン一覧:**
```typescript
const CATEGORY_ICONS: CategoryIcon[] = [
  { id: 'pin', icon: '📌', label: 'ピン', color: '#EF4444' },
  { id: 'book', icon: '📚', label: '本', color: '#3B82F6' },
  { id: 'folder', icon: '📁', label: 'フォルダ', color: '#F59E0B' },
  { id: 'star', icon: '⭐', label: 'スター', color: '#EAB308' },
  { id: 'graph', icon: '📊', label: 'グラフ', color: '#8B5CF6' },
  { id: 'sun', icon: '☀️', label: '太陽', color: '#F97316' },
  { id: 'person', icon: '👤', label: '人物', color: '#6B7280' },
  { id: 'hospital', icon: '🏥', label: '病院', color: '#EC4899' },
  { id: 'plus', icon: '➕', label: 'プラス', color: '#10B981' },
  { id: 'leaf', icon: '🍃', label: '葉', color: '#22C55E' },
  { id: 'search', icon: '🔍', label: '虫眼鏡', color: '#6366F1' },
  { id: 'people', icon: '👥', label: '複数人', color: '#8B5CF6' },
  { id: 'snow', icon: '❄️', label: '雪', color: '#06B6D4' },
  { id: 'fire', icon: '🔥', label: '炎', color: '#DC2626' },
  { id: 'lightning', icon: '⚡', label: '雷', color: '#EACC0B' },
];
```

**スタイル:**

未選択時:
- 背景色: グレー薄め (#F3F4F6)
- ボーダー: 2px solid transparent
- 不透明度: 0.6

選択時:
- 背景色: プライマリーカラー薄め (#EFF6FF)
- ボーダー: 2px solid プライマリーカラー (#3B82F6)
- 不透明度: 1.0
- シャドウ: 0 0 0 4px rgba(59, 130, 246, 0.1)

ホバー時:
- 背景色: グレー中間 (#E5E7EB)
- カーソル: pointer

ボーダーラジアス: 12px
トランジション: 150ms ease

**デフォルト選択:**
- 作成モード: 📌（pin）
- 編集モード: 現在のカテゴリー

#### 日付ピッカー（Date Picker）

**表示形式:**
- フォーマット: YYYY/MM/DD
- 例: "2026/01/15"

**スタイル:**
- フォントサイズ: 16px
- パディング: 12px（上下）、16px（左右）
- ボーダー: 1px solid #E5E7EB
- ボーダーラジアス: 8px
- 背景色: 白 (#FFFFFF)
- アイコン: 📅（カレンダーアイコン）右端に表示

**動作:**
- タップでカレンダーピッカーを表示
- ネイティブの日付ピッカーを使用（モバイル）
- カスタムカレンダーコンポーネントを使用（デスクトップ）

**デフォルト値:**
- 作成モード: 現在日付
- 編集モード: 最終実行日

**制約:**
- 未来の日付も選択可能（予定としての登録を許可）
- 最小日付: 1900/01/01
- 最大日付: 2099/12/31

#### 時刻ピッカー（Time Picker）

**表示形式:**
- フォーマット: HH:mm（24時間形式）
- 例: "23:31"

**スタイル:**
- 日付ピッカーと同じスタイル
- アイコン: 🕐（時計アイコン）右端に表示

**動作:**
- タップで時刻ピッカーを表示
- ネイティブの時刻ピッカーを使用（モバイル）
- カスタム時刻セレクターを使用（デスクトップ）
- 1分単位で選択可能

**デフォルト値:**
- 作成モード: 現在時刻
- 編集モード: 最終実行時刻

## 3. 機能詳細

### 3.1 イベント作成フロー

```
1. FABタップ
   ↓
2. 作成画面表示
   ↓
3. イベント名入力（必須）
   ↓
4. カテゴリーアイコン選択（デフォルト: 📌）
   ↓
5. 日時選択（デフォルト: 現在日時）
   ↓
6. 完了ボタンタップ
   ↓
7. バリデーション
   ↓
8. API呼び出し（POST /events）
   ↓
9. 成功 → メイン画面に戻る + トースト通知
   失敗 → エラーメッセージ表示
```

### 3.2 イベント編集フロー

```
1. イベント履歴画面で編集ボタンタップ
   ↓
2. 編集画面表示 + ローディング
   ↓
3. API呼び出し（GET /events/:id）
   ↓
4. フォームに既存データを表示
   ↓
5. ユーザーが編集
   ↓
6. 完了ボタンタップ
   ↓
7. バリデーション
   ↓
8. API呼び出し（PUT /events/:id）
   ↓
9. 成功 → イベント履歴画面に戻る + トースト通知
   失敗 → エラーメッセージ表示
```

### 3.3 バリデーション

#### イベント名
```typescript
interface EventNameValidation {
  required: true;
  maxLength: 100;
  pattern?: RegExp; // 必要に応じて
}

const validateEventName = (name: string): ValidationResult => {
  if (!name || name.trim().length === 0) {
    return {
      isValid: false,
      error: 'イベント名を入力してください',
    };
  }
  
  if (name.length > 100) {
    return {
      isValid: false,
      error: 'イベント名は100文字以内で入力してください',
    };
  }
  
  return { isValid: true };
};
```

#### カテゴリーアイコン
- 必須項目
- 15個のアイコンから1つ選択
- デフォルト値があるため、通常エラーにはならない

#### 日時
- 必須項目
- デフォルト値があるため、通常エラーにはならない
- 日付と時刻の組み合わせが有効な日時であることを確認

### 3.4 保存処理

#### 作成時（POST）
```typescript
interface CreateEventRequest {
  name: string;
  categoryIcon: CategoryType;
  lastExecutedAt: string; // ISO 8601形式
}

const createEvent = async (data: CreateEventRequest) => {
  try {
    const response = await $fetch('/events', {
      method: 'POST',
      body: data,
    });
    
    // 成功処理
    showToast('イベントを作成しました');
    navigateTo('/');
  } catch (error) {
    // エラー処理
    showErrorMessage('イベントの作成に失敗しました');
  }
};
```

#### 更新時（PUT）
```typescript
interface UpdateEventRequest {
  name: string;
  categoryIcon: CategoryType;
  lastExecutedAt: string; // ISO 8601形式
}

const updateEvent = async (id: string, data: UpdateEventRequest) => {
  try {
    const response = await $fetch(`/events/${id}`, {
      method: 'PUT',
      body: data,
    });
    
    // 成功処理
    showToast('イベントを更新しました');
    navigateTo(`/events/${id}/history`);
  } catch (error) {
    // エラー処理
    showErrorMessage('イベントの更新に失敗しました');
  }
};
```

### 3.5 キャンセル処理

#### 変更検知
```typescript
const hasChanges = computed(() => {
  if (mode === 'create') {
    // 作成モードの場合
    return eventName.value.trim().length > 0 ||
           selectedIcon.value !== 'pin' ||
           !isSameDateTime(selectedDateTime.value, new Date());
  } else {
    // 編集モードの場合
    return eventName.value !== originalData.name ||
           selectedIcon.value !== originalData.categoryIcon ||
           !isSameDateTime(selectedDateTime.value, originalData.lastExecutedAt);
  }
});
```

#### キャンセル確認ダイアログ
変更がある場合のみ表示：
```
┌─────────────────────────────────────┐
│                                     │
│  変更を破棄しますか？                │
│                                     │
│  入力した内容は保存されません。      │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │キャンセル│  │  破棄   │          │
│  └─────────┘  └─────────┘          │
│                                     │
└─────────────────────────────────────┘
```

- **キャンセル**: ダイアログを閉じて編集を続行
- **破棄**: 入力内容を破棄して前の画面に戻る

### 3.6 キーボード操作

#### タブ順序
1. イベント名入力
2. カテゴリーアイコン（グリッド内をArrowキーで移動）
3. 日付ピッカー
4. 時刻ピッカー
5. 完了ボタン

#### ショートカット
- **Enter**: 完了ボタンと同じ動作（イベント名入力中）
- **Esc**: キャンセル
- **Cmd/Ctrl + S**: 保存（完了と同じ）

## 4. 状態管理

### 4.1 コンポーネント状態

```typescript
interface EventFormState {
  // モード
  mode: 'create' | 'edit';
  eventId?: string; // 編集モードの場合のみ
  
  // フォーム入力値
  eventName: string;
  selectedIcon: CategoryType;
  selectedDate: Date;
  selectedTime: { hour: number; minute: number };
  
  // UI状態
  isLoading: boolean;
  isSaving: boolean;
  showCancelDialog: boolean;
  
  // エラー
  errors: {
    eventName?: string;
    general?: string;
  };
  
  // 編集時の元データ（変更検知用）
  originalData?: {
    name: string;
    categoryIcon: CategoryType;
    lastExecutedAt: Date;
  };
}
```

### 4.2 Composable（例）

```typescript
// composables/useEventForm.ts
export const useEventForm = (mode: 'create' | 'edit', eventId?: string) => {
  const eventName = ref('');
  const selectedIcon = ref<CategoryType>('pin');
  const selectedDateTime = ref(new Date());
  const isLoading = ref(false);
  const isSaving = ref(false);
  const errors = ref<Record<string, string>>({});
  const originalData = ref<any>(null);
  
  // 編集モードの場合、データを取得
  const loadEvent = async () => {
    if (mode === 'edit' && eventId) {
      isLoading.value = true;
      try {
        const { data } = await $fetch(`/events/${eventId}`);
        eventName.value = data.event.name;
        selectedIcon.value = data.event.categoryIcon;
        selectedDateTime.value = new Date(data.event.lastExecutedAt);
        originalData.value = {
          name: data.event.name,
          categoryIcon: data.event.categoryIcon,
          lastExecutedAt: new Date(data.event.lastExecutedAt),
        };
      } catch (error) {
        errors.value.general = 'イベントの読み込みに失敗しました';
      } finally {
        isLoading.value = false;
      }
    }
  };
  
  // バリデーション
  const validate = (): boolean => {
    errors.value = {};
    
    if (!eventName.value.trim()) {
      errors.value.eventName = 'イベント名を入力してください';
      return false;
    }
    
    if (eventName.value.length > 100) {
      errors.value.eventName = 'イベント名は100文字以内で入力してください';
      return false;
    }
    
    return true;
  };
  
  // 保存処理
  const save = async () => {
    if (!validate()) return;
    
    isSaving.value = true;
    try {
      const payload = {
        name: eventName.value.trim(),
        categoryIcon: selectedIcon.value,
        lastExecutedAt: selectedDateTime.value.toISOString(),
      };
      
      if (mode === 'create') {
        await $fetch('/events', {
          method: 'POST',
          body: payload,
        });
        showToast('イベントを作成しました');
        navigateTo('/');
      } else {
        await $fetch(`/events/${eventId}`, {
          method: 'PUT',
          body: payload,
        });
        showToast('イベントを更新しました');
        navigateTo(`/events/${eventId}/history`);
      }
    } catch (error) {
      errors.value.general = mode === 'create' 
        ? 'イベントの作成に失敗しました'
        : 'イベントの更新に失敗しました';
    } finally {
      isSaving.value = false;
    }
  };
  
  // 変更検知
  const hasChanges = computed(() => {
    if (mode === 'create') {
      return eventName.value.trim().length > 0 ||
             selectedIcon.value !== 'pin' ||
             selectedDateTime.value.getTime() !== new Date().getTime();
    } else if (originalData.value) {
      return eventName.value !== originalData.value.name ||
             selectedIcon.value !== originalData.value.categoryIcon ||
             selectedDateTime.value.getTime() !== originalData.value.lastExecutedAt.getTime();
    }
    return false;
  });
  
  return {
    eventName,
    selectedIcon,
    selectedDateTime,
    isLoading,
    isSaving,
    errors,
    hasChanges,
    loadEvent,
    validate,
    save,
  };
};
```

## 5. API仕様

### 5.1 イベント作成

#### エンドポイント
```
POST /events
```

#### リクエストボディ
```typescript
interface CreateEventRequest {
  name: string;              // イベント名（必須、最大100文字）
  categoryIcon: CategoryType; // カテゴリーアイコン（必須）
  lastExecutedAt: string;    // 最終実行日時（ISO 8601形式、必須）
}
```

#### リクエスト例
```json
{
  "name": "エアコンフィルター掃除",
  "categoryIcon": "leaf",
  "lastExecutedAt": "2026-01-15T23:31:00Z"
}
```

#### レスポンス

**成功時（201 Created）:**
```typescript
interface CreateEventResponse {
  success: true;
  data: {
    event: Event;
  };
}

interface Event {
  id: string;
  name: string;
  categoryIcon: CategoryType;
  lastExecutedAt: string;
  createdAt: string;
  updatedAt: string;
}
```

**レスポンス例:**
```json
{
  "success": true,
  "data": {
    "event": {
      "id": "evt_1234567890",
      "name": "エアコンフィルター掃除",
      "categoryIcon": "leaf",
      "lastExecutedAt": "2026-01-15T23:31:00Z",
      "createdAt": "2026-01-16T10:00:00Z",
      "updatedAt": "2026-01-16T10:00:00Z"
    }
  }
}
```

**エラー時:**
```typescript
interface ErrorResponse {
  success: false;
  error: {
    code: string;
    message: string;
    details?: any;
  };
}
```

**エラーレスポンス例:**
```json
// 400 Bad Request - バリデーションエラー
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力内容に誤りがあります",
    "details": {
      "name": "イベント名は必須です"
    }
  }
}

// 401 Unauthorized - 認証エラー
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Authentication required"
  }
}

// 500 Internal Server Error
{
  "success": false,
  "error": {
    "code": "INTERNAL_SERVER_ERROR",
    "message": "An unexpected error occurred"
  }
}
```

#### ステータスコード

| コード | 説明 |
|-------|------|
| 201 | 作成成功 |
| 400 | バリデーションエラー |
| 401 | 認証が必要 |
| 403 | アクセス権限がない |
| 500 | サーバー内部エラー |

### 5.2 イベント詳細取得（編集時）

#### エンドポイント
```
GET /events/:id
```

#### パスパラメータ
- `id`: イベントID

#### リクエスト例
```bash
GET /events/evt_1234567890
```

#### レスポンス

**成功時（200 OK）:**
```typescript
interface GetEventResponse {
  success: true;
  data: {
    event: Event;
  };
}
```

**レスポンス例:**
```json
{
  "success": true,
  "data": {
    "event": {
      "id": "evt_1234567890",
      "name": "エアコンフィルター掃除",
      "categoryIcon": "leaf",
      "lastExecutedAt": "2023-10-01T10:00:00Z",
      "lastExecutedMemo": "フィルターを水洗いした",
      "createdAt": "2023-01-01T00:00:00Z",
      "updatedAt": "2023-10-01T10:00:00Z"
    }
  }
}
```

**エラー時:**
```json
// 404 Not Found
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Event not found"
  }
}
```

#### ステータスコード

| コード | 説明 |
|-------|------|
| 200 | 成功 |
| 401 | 認証が必要 |
| 404 | イベントが見つからない |
| 500 | サーバー内部エラー |

### 5.3 イベント更新

#### エンドポイント
```
PUT /events/:id
```

#### パスパラメータ
- `id`: イベントID

#### リクエストボディ
```typescript
interface UpdateEventRequest {
  name: string;              // イベント名（必須、最大100文字）
  categoryIcon: CategoryType; // カテゴリーアイコン（必須）
  lastExecutedAt: string;    // 最終実行日時（ISO 8601形式、必須）
}
```

#### リクエスト例
```json
PUT /events/evt_1234567890

{
  "name": "エアコンフィルター掃除（更新）",
  "categoryIcon": "leaf",
  "lastExecutedAt": "2026-01-15T23:31:00Z"
}
```

#### レスポンス

**成功時（200 OK）:**
```typescript
interface UpdateEventResponse {
  success: true;
  data: {
    event: Event;
  };
}
```

**レスポンス例:**
```json
{
  "success": true,
  "data": {
    "event": {
      "id": "evt_1234567890",
      "name": "エアコンフィルター掃除（更新）",
      "categoryIcon": "leaf",
      "lastExecutedAt": "2026-01-15T23:31:00Z",
      "createdAt": "2023-01-01T00:00:00Z",
      "updatedAt": "2026-01-16T10:30:00Z"
    }
  }
}
```

**エラー時:**
```json
// 400 Bad Request
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力内容に誤りがあります",
    "details": {
      "name": "イベント名は100文字以内で入力してください"
    }
  }
}

// 404 Not Found
{
  "success": false,
  "error": {
    "code": "NOT_FOUND",
    "message": "Event not found"
  }
}
```

#### ステータスコード

| コード | 説明 |
|-------|------|
| 200 | 更新成功 |
| 400 | バリデーションエラー |
| 401 | 認証が必要 |
| 404 | イベントが見つからない |
| 500 | サーバー内部エラー |

## 6. レスポンシブデザイン

### 6.1 ブレークポイント別の表示

#### モバイル（0px - 640px）
- 全画面表示（モーダル）
- パディング: 16px
- アイコングリッド: 5列
- 日付・時刻ピッカー: ネイティブピッカー使用

#### タブレット（641px - 1024px）
- 中央寄せモーダル（幅: 600px）
- パディング: 24px
- アイコングリッド: 5列
- 日付・時刻ピッカー: カスタムコンポーネント

#### デスクトップ（1025px以上）
- 中央寄せモーダル（幅: 640px）
- パディング: 32px
- アイコングリッド: 5列
- 日付・時刻ピッカー: カスタムコンポーネント

### 6.2 モーダルスタイル

```typescript
const modalStyle = {
  mobile: {
    position: 'fixed',
    top: 0,
    left: 0,
    right: 0,
    bottom: 0,
    backgroundColor: '#FFFFFF',
  },
  desktop: {
    position: 'fixed',
    top: '50%',
    left: '50%',
    transform: 'translate(-50%, -50%)',
    width: '640px',
    maxHeight: '90vh',
    backgroundColor: '#FFFFFF',
    borderRadius: '16px',
    boxShadow: '0 20px 25px -5px rgba(0, 0, 0, 0.1)',
  },
};
```

## 7. アクセシビリティ

### 7.1 キーボード操作
- Tab キー: フォーカス移動
- Enter キー: フォーカス中の要素を実行、または完了
- Space キー: アイコン選択
- Esc キー: キャンセル
- Arrow キー: アイコングリッド内の移動

### 7.2 スクリーンリーダー対応

```html
<!-- フォーム -->
<form role="form" aria-label="イベント作成フォーム">
  <!-- イベント名 -->
  <label for="event-name">イベント名 (必須)</label>
  <input
    id="event-name"
    type="text"
    aria-required="true"
    aria-invalid="false"
    aria-describedby="event-name-error"
    maxlength="100"
  />
  <div id="event-name-error" role="alert" aria-live="polite">
    <!-- エラーメッセージ -->
  </div>
  
  <!-- カテゴリー選択 -->
  <fieldset>
    <legend>カテゴリー (必須)</legend>
    <div role="radiogroup" aria-label="カテゴリーアイコン選択">
      <button
        role="radio"
        aria-checked="true"
        aria-label="ピンカテゴリー"
        tabindex="0"
      >
        📌
      </button>
      <!-- 他のアイコン -->
    </div>
  </fieldset>
  
  <!-- 日時選択 -->
  <label for="event-date">日付 (必須)</label>
  <input
    id="event-date"
    type="date"
    aria-required="true"
  />
  
  <label for="event-time">時刻 (必須)</label>
  <input
    id="event-time"
    type="time"
    aria-required="true"
  />
</form>
```

### 7.3 フォーカス管理
- 画面表示時、イベント名入力にフォーカス
- エラー発生時、最初のエラー項目にフォーカス
- モーダル内でフォーカストラップ（外部に移動しない）

### 7.4 色とコントラスト
- WCAG 2.1 レベル AA 準拠
- エラーメッセージは色だけでなくアイコンも使用
- 選択状態をボーダーとシャドウで明示

## 8. アニメーション

### 8.1 モーダルの表示・非表示

```typescript
// モバイル: 下からスライドイン
const mobileAnimation = {
  enterFromClass: 'translate-y-full',
  enterActiveClass: 'transition-transform duration-300 ease-out',
  enterToClass: 'translate-y-0',
  leaveFromClass: 'translate-y-0',
  leaveActiveClass: 'transition-transform duration-250 ease-in',
  leaveToClass: 'translate-y-full',
};

// デスクトップ: フェード + スケール
const desktopAnimation = {
  enterFromClass: 'opacity-0 scale-95',
  enterActiveClass: 'transition-all duration-200 ease-out',
  enterToClass: 'opacity-100 scale-100',
  leaveFromClass: 'opacity-100 scale-100',
  leaveActiveClass: 'transition-all duration-150 ease-in',
  leaveToClass: 'opacity-0 scale-95',
};
```

### 8.2 インタラクション
- アイコン選択: スケールアニメーション（150ms）
- 完了ボタン押下: リップルエフェクト
- エラー表示: シェイクアニメーション（300ms）

## 9. エラーハンドリング

### 9.1 バリデーションエラー
- リアルタイムバリデーション（入力時）
- エラーメッセージを該当フィールド下に表示
- 赤色のボーダーで視覚的に強調

### 9.2 ネットワークエラー
- タイムアウト: 30秒
- リトライボタンを表示
- オフライン時は適切なメッセージを表示

### 9.3 サーバーエラー
```
┌─────────────────────────────────────┐
│                                     │
│  ⚠️  エラーが発生しました            │
│                                     │
│  イベントの保存に失敗しました。      │
│  もう一度お試しください。            │
│                                     │
│  ┌─────────┐  ┌─────────┐          │
│  │閉じる   │  │再試行   │          │
│  └─────────┘  └─────────┘          │
│                                     │
└─────────────────────────────────────┘
```

## 10. テストケース

### 10.1 作成モードのテスト
- [ ] FABタップで作成画面が表示される
- [ ] デフォルトでピンアイコンが選択されている
- [ ] デフォルトで現在日時が設定されている
- [ ] イベント名を入力できる
- [ ] カテゴリーアイコンを選択できる
- [ ] 日付を変更できる
- [ ] 時刻を変更できる
- [ ] 完了ボタンタップでイベントが作成される
- [ ] 作成成功後、メイン画面に戻る
- [ ] 成功時にトースト通知が表示される

### 10.2 編集モードのテスト
- [ ] 編集画面が表示される
- [ ] 既存データがフォームに表示される
- [ ] イベント名を編集できる
- [ ] カテゴリーアイコンを変更できる
- [ ] 日時を変更できる
- [ ] 完了ボタンタップで更新される
- [ ] 更新成功後、履歴画面に戻る
- [ ] 成功時にトースト通知が表示される

### 10.3 バリデーションテスト
- [ ] イベント名が空の場合、エラーメッセージが表示される
- [ ] イベント名が100文字を超える場合、エラーメッセージが表示される
- [ ] エラーがある場合、完了ボタンが無効になる
- [ ] エラー修正後、完了ボタンが有効になる

### 10.4 キャンセル処理テスト
- [ ] 変更なしでキャンセルすると、確認なしで戻る
- [ ] 変更ありでキャンセルすると、確認ダイアログが表示される
- [ ] ダイアログで「破棄」を選択すると戻る
- [ ] ダイアログで「キャンセル」を選択すると編集を続行

### 10.5 APIエラーテスト
- [ ] ネットワークエラー時、適切なエラーメッセージが表示される
- [ ] サーバーエラー時、適切なエラーメッセージが表示される
- [ ] 404エラー時（編集モード）、適切なメッセージが表示される
- [ ] リトライボタンで再実行できる

### 10.6 レスポンシブテスト
- [ ] モバイルで適切に表示される
- [ ] タブレットで適切に表示される
- [ ] デスクトップで適切に表示される
- [ ] 画面サイズ変更時も正しく動作する

### 10.7 アクセシビリティテスト
- [ ] キーボードで操作できる
- [ ] スクリーンリーダーで読み上げられる
- [ ] フォーカストラップが機能する
- [ ] エラー時にARIA属性が更新される

## 11. 実装優先順位（Phase 1 MVP）

### 優先度: 高
1. イベント名入力
2. カテゴリーアイコン選択
3. 日時選択（ネイティブピッカー）
4. 作成API連携
5. 更新API連携
6. 基本的なバリデーション

### 優先度: 中
7. キャンセル確認ダイアログ
8. エラーハンドリング
9. トースト通知
10. ローディング表示

### 優先度: 低（Phase 2以降）
11. カスタム日時ピッカー（デスクトップ）
12. リアルタイムバリデーション
13. キーボードショートカット
14. アニメーションの詳細調整

## 12. 技術的な実装メモ

### 12.1 コンポーネント構成（Vue 3 / Nuxt 3）

```
pages/
  events/
    new.vue                  # 作成画面
    [id]/
      edit.vue              # 編集画面
      
components/
  EventForm/
    index.vue               # フォーム本体
    EventNameInput.vue      # イベント名入力
    CategoryIconSelector.vue # カテゴリー選択
    DateTimePicker.vue      # 日時選択
    FormActions.vue         # キャンセル・完了ボタン

composables/
  useEventForm.ts           # フォームロジック
```

### 12.2 使用するライブラリ
- **フォーム管理**: VeeValidate（バリデーション）
- **日時処理**: dayjs
- **UI コンポーネント**: Nuxt UI v4
  - `<UInput>`: テキスト入力
  - `<UButton>`: ボタン
  - `<UModal>`: モーダル（デスクトップ）
  - `<UFormGroup>`: フォームグループ
- **通知**: Nuxt UI Toast

### 12.3 実装例

```vue
<!-- pages/events/new.vue -->
<template>
  <UModal v-model="isOpen" :ui="modalUi">
    <div class="p-6">
      <!-- ヘッダー -->
      <div class="flex items-center justify-between mb-6">
        <button @click="handleCancel" aria-label="キャンセル">
          <UIcon name="i-heroicons-x-mark" class="w-6 h-6" />
        </button>
        <h1 class="text-lg font-semibold">新しいイベント</h1>
        <UButton
          :disabled="!isValid || isSaving"
          :loading="isSaving"
          @click="handleSave"
        >
          完了
        </UButton>
      </div>
      
      <!-- フォーム -->
      <form @submit.prevent="handleSave">
        <!-- イベント名 -->
        <UFormGroup label="イベント名" :error="errors.eventName" required>
          <UInput
            v-model="eventName"
            placeholder="重要なイベントをここに入力する"
            maxlength="100"
            :ui="{ base: 'w-full' }"
          />
        </UFormGroup>
        
        <!-- カテゴリー -->
        <UFormGroup label="カテゴリー" class="mt-6" required>
          <CategoryIconSelector v-model="selectedIcon" />
        </UFormGroup>
        
        <!-- 日時 -->
        <UFormGroup label="最終実行日時" class="mt-6" required>
          <DateTimePicker v-model="selectedDateTime" />
        </UFormGroup>
      </form>
    </div>
  </UModal>
  
  <!-- キャンセル確認ダイアログ -->
  <ConfirmDialog
    v-model="showCancelDialog"
    title="変更を破棄しますか？"
    message="入力した内容は保存されません。"
    confirmText="破棄"
    @confirm="handleConfirmCancel"
  />
</template>

<script setup lang="ts">
const route = useRoute();
const router = useRouter();

const isOpen = ref(true);
const {
  eventName,
  selectedIcon,
  selectedDateTime,
  isLoading,
  isSaving,
  errors,
  isValid,
  hasChanges,
  save,
} = useEventForm('create');

const handleSave = async () => {
  await save();
};

const handleCancel = () => {
  if (hasChanges.value) {
    showCancelDialog.value = true;
  } else {
    router.back();
  }
};

const handleConfirmCancel = () => {
  router.back();
};

// モーダルが閉じられたときの処理
watch(isOpen, (value) => {
  if (!value) {
    handleCancel();
  }
});
</script>
```

## 13. 今後の拡張性

### Phase 2以降で追加予定
- イベントのメモ入力（作成時）
- 画像・写真の添付
- テンプレートからの作成
- 繰り返し設定（定期イベント）
- タグ機能
- 優先度設定

---

**作成日**: 2026/01/16  
**バージョン**: 1.0  
**更新履歴**:
- 2026/01/16: 初版作成
